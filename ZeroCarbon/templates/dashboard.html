<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zero Carbon Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --primary: #0B3D2E;
    --secondary: #1F6F8B;
    --accent: #2ECC71;
    --bg-light: #F4F7F9;
    --text-dark: #1F2933;
    --danger: #E74C3C;
}

body {
    min-height: 100vh;
    margin: 0;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
}

.dashboard-card {
    background: #ffffff;
    width: 100%;
    max-width: 700px;
    padding: 34px;
    border-radius: 18px;
    box-shadow: 0 25px 60px rgba(0, 0, 0, 0.25);
}

.dashboard-card h2 {
    text-align: center;
    margin-bottom: 28px;
    color: var(--primary);
    font-weight: 800;
}

/* ===== LOCATION & AQI ===== */
.aqi-card {
    background: var(--bg-light);
    padding: 20px;
    border-radius: 16px;
    margin-bottom: 26px;
}

.aqi-card h3 {
    margin-top: 0;
    color: var(--primary);
}

#place {
    font-weight: 600;
    color: var(--secondary);
}

.env-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    margin: 16px 0;
}

.env-item {
    background: #ffffff;
    padding: 12px;
    border-radius: 14px;
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-dark);
}

/* ===== AQI STATES ===== */
.aqi-box {
    margin-top: 12px;
    padding: 16px;
    border-radius: 14px;
    font-weight: 700;
}

.aqi-good { background: #d1fae5; color: #065f46; }
.aqi-moderate { background: #fef3c7; color: #92400e; }
.aqi-unhealthy { background: #fee2e2; color: #991b1b; }

.aqi-tip {
    margin-top: 10px;
    font-size: 14px;
    color: var(--text-dark);
}

/* ===== MENU ===== */
.menu {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 18px;
    margin-top: 30px;
}

.menu a {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 18px;
    background: var(--bg-light);
    border-radius: 16px;
    text-decoration: none;
    font-size: 16px;
    font-weight: 600;
    color: var(--primary);
    transition: all 0.3s ease;
}

.menu a:hover {
    background: var(--accent);
    color: var(--primary);
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(46, 204, 113, 0.35);
}

/* ===== LOGOUT ===== */
.logout {
    margin-top: 30px;
    text-align: center;
}

.logout a {
    color: var(--danger);
    text-decoration: none;
    font-weight: 700;
    font-size: 14px;
}

.logout a:hover {
    text-decoration: underline;
}
</style>
</head>

<body>

<div class="dashboard-card">
    <h2>Zero Carbon Dashboard</h2>

    <div class="aqi-card">
        <h3>üìç Your Location & Environment</h3>

        <p id="place">Detecting location...</p>
        <p id="coords" style="font-size:13px;color:#6b7280;"></p>

        <div class="env-grid">
            <div class="env-item">üå° Temperature : <br><span id="temp">--</span></div>
            <div class="env-item">üíß Humidity : <br><span id="humidity">--</span></div>
            <div class="env-item">üå¨ Weather : <br><span id="weather">--</span></div>
        </div>

        <div id="aqi-box" class="aqi-box">
            <strong id="aqi-value">AQI --</strong>
            <span id="aqi-status"></span>
        </div>

        <p id="aqi-tip" class="aqi-tip"></p>
    </div>

    <div class="menu">
        <a href="/dashboard/carbon-advisor/">ü§ñ Carbon Advisor</a>
        <a href="/dashboard/summary/">üìä Carbon Summary</a>
        <a href="/dashboard/food/">üçΩ Food</a>
        <a href="/dashboard/electricity/">‚ö° Electricity</a>
        <a href="/dashboard/travel/">üöó Travel</a>
        <a href="/dashboard/waste/">‚ôª Waste Segregation</a>
        <a href="http://localhost:8501" target="_blank">üìà Analytics & Insights</a>
    </div>

    <div class="logout">
        <a href="/logout/">Logout</a>
    </div>
</div>

<!-- JS UNCHANGED -->
<script>
const API_KEY = "31734a7888fed2a98c780fcc08a74046";

function calculateAQI(pm25) {
    const bp = [
        [0,12,0,50],[12.1,35.4,51,100],[35.5,55.4,101,150],
        [55.5,150.4,151,200],[150.5,250.4,201,300],[250.5,500.4,301,500]
    ];
    for (const [cL,cH,aL,aH] of bp) {
        if (pm25 >= cL && pm25 <= cH) {
            return Math.round(((aH-aL)/(cH-cL))*(pm25-cL)+aL);
        }
    }
}

function getAQIStatus(aqi) {
    if (aqi <= 50) return ["Good","aqi-good","Excellent air quality üå±"];
    if (aqi <= 100) return ["Moderate","aqi-moderate","Acceptable air quality"];
    if (aqi <= 150) return ["Unhealthy (Sensitive)","aqi-moderate","Sensitive groups reduce exposure"];
    if (aqi <= 200) return ["Unhealthy","aqi-unhealthy","Reduce outdoor activity"];
    if (aqi <= 300) return ["Very Unhealthy","aqi-unhealthy","Avoid outdoor activities"];
    return ["Hazardous","aqi-unhealthy","Stay indoors"];
}

function fetchAQI(lat, lon) {
    fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`)
    .then(r=>r.json())
    .then(d=>{
        const pm25=d.list[0].components.pm2_5;
        const aqi=calculateAQI(pm25);
        const [txt,cls,tip]=getAQIStatus(aqi);

        document.getElementById("aqi-box").className=`aqi-box ${cls}`;
        document.getElementById("aqi-value").innerText=`AQI ${aqi}`;
        document.getElementById("aqi-status").innerText=` ${txt}`;
        document.getElementById("aqi-tip").innerText=`${tip} (PM2.5: ${pm25} ¬µg/m¬≥)`;
    });
}

navigator.geolocation.getCurrentPosition(pos=>{
    const lat=pos.coords.latitude, lon=pos.coords.longitude;
    document.getElementById("coords").innerText=`Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}`;

    fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${API_KEY}`)
    .then(r=>r.json()).then(d=>{
        document.getElementById("place").innerText=`${d[0].name}, ${d[0].state}, ${d[0].country}`;
    });

    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`)
    .then(r=>r.json()).then(d=>{
        document.getElementById("temp").innerText=`${d.main.temp}¬∞C`;
        document.getElementById("humidity").innerText=`${d.main.humidity}%`;
        document.getElementById("weather").innerText=d.weather[0].main;
    });

    fetchAQI(lat,lon);
});
</script>

</body>
</html>
